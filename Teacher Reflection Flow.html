<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher Reflection Flow: CBE & Learning Outcomes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #fcfcfc; /* Soft Off-White Background */
        }
        .reflection-card {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transition: all 0.4s ease-out;
            border-left: 8px solid #06b6d4; /* Cyan 500 accent border */
            scroll-margin-top: 20px;
        }
        .reflection-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 20px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.05);
        }
        .reflection-card.completed {
            border-left-color: #4ade80; /* Vibrant Green 400 for completed cards */
        }
        .rating-button {
            transition: transform 0.15s ease-out, background-color 0.15s, box-shadow 0.15s;
            transform: scale(0.95);
        }
        .rating-button:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        .rating-button.selected {
            background-color: #4ade80; /* Vibrant Green 400 for selected */
            color: white;
            border-color: #22c55e;
            transform: scale(1.05);
        }
        .task-box {
            background-color: #f0fdf4; /* Lightest Mint Green background */
            border: 1px solid #dcfce7;
        }
        /* Styling for the animated feedback area */
        .feedback-area {
            opacity: 0;
            max-height: 0;
            overflow: hidden;
            transition: opacity 0.5s ease-out, max-height 0.7s ease-out, padding 0.5s;
            padding: 0 1rem;
            background-color: #f5f3ff; /* Light Violet/Purple 50 background */
            border-radius: 0.5rem;
            margin-top: 1rem;
        }
        .feedback-area.visible {
            opacity: 1;
            max-height: 500px;
            padding: 1rem;
        }
        /* Custom styling for a vibrant reflection container */
        .reflection-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }
    </style>
</head>
<body>

    <div id="app" class="reflection-container">

        <!-- Header -->
        <header class="text-center mb-10 p-4 bg-white rounded-xl shadow-lg border-b-4 border-cyan-500">
            <h1 class="text-3xl font-bold text-gray-800 mb-1">Interactive Reflection Flow</h1>
            <p class="text-md text-cyan-600 font-semibold">
                Lesson Competency: Understanding Curricular Goals, CBE, and Learning Outcomes
            </p>
        </header>
        
        <!-- Progress Bar (New Feature) -->
        <div class="mb-8 p-4 bg-white rounded-xl shadow-md border border-gray-100">
            <h3 class="text-sm font-semibold text-gray-700 mb-2">Your Progress</h3>
            <div class="w-full bg-gray-200 rounded-full h-2.5">
                <div id="progress-bar" class="bg-cyan-500 h-2.5 rounded-full transition-all duration-500 ease-out" style="width: 0%"></div>
            </div>
            <p id="progress-text" class="text-xs text-gray-500 mt-1 text-right">0 of 7 reflections complete</p>
        </div>

        <!-- Intro (Warm-up) -->
        <div class="mb-10 p-6 bg-amber-50 rounded-xl border border-amber-200">
            <h2 class="text-xl font-bold text-amber-700 mb-3">üëã Warm-up Reflection</h2>
            <p class="text-gray-700 leading-relaxed">
                Hi! Before we dive into competency-based education, let‚Äôs take a moment to reflect on your classroom practices. There are no right or wrong answers ‚Äî this is just a space to think about what you already do and explore small ways to strengthen your teaching. Let's get started!
            </p>
        </div>

        <!-- Reflection Sections will be injected here -->
        <div id="reflections-list" class="space-y-8">
            <!-- Content generated by JS -->
        </div>

        <!-- Wrap-Up Summary (Initially hidden) -->
        <div id="wrap-up-summary" class="hidden mt-12 p-8 bg-emerald-100 rounded-xl border-t-8 border-emerald-500 shadow-xl">
            <h2 class="text-2xl font-bold text-emerald-800 mb-4 flex items-center">
                <span class="mr-2 text-3xl">üåº</span> Your Reflection Summary
            </h2>
            <p id="summary-text" class="text-gray-700 leading-relaxed text-lg">
                <!-- Summary text injected here -->
            </p>
            <p class="mt-4 text-sm text-emerald-600 font-medium">
                Keep reflecting and trying these small steps ‚Äî they help make learning meaningful for your students!
            </p>
        </div>

    </div>

    <script>
        const REFLECTIONS = [
            {
                id: 1,
                title: "Student Engagement (Agency)",
                prompt: "Imagine a regular day in your class. How often are your students actively engaged ‚Äî asking questions, explaining answers, or applying ideas to real life?",
                followUps: {
                    "1_2": "It‚Äôs great that you‚Äôre noticing this. Students need a safe space to share. What is one low-stakes technique, like a **‚ÄòThink-Pair-Share‚Äô** or a quick *‚ÄòTurn-and-Talk‚Äô*, that you could use next week to make sharing feel less risky?",
                    "3": "You‚Äôre creating space for student voice‚Äîa solid start! To move forward, reflect on the last two lessons: Did student questions mostly lead to deeper learning, or were they about clarifying instructions? What type of question or activity gets them **most engaged**?",
                    "4_5": "Wonderful! Encouraging students to ask questions and explain their thinking is at the heart of CBE. To expand this, how could you start having students **critique their own work or their peers‚Äô work** based on a specific success criterion?",
                },
                task: "üå± **Try a low-stakes activity:** In your next class, give students one chance to explain a concept to a peer in their own words. After class, jot down what percentage of students participated willingly and what could improve.",
            },
            {
                id: 2,
                title: "Focus on Application",
                prompt: "When teaching a topic (e.g., ‚ÄúMeasurements‚Äù or ‚ÄúPlant Life‚Äù), how often do you check if students can **apply** what they learn to a new, real-life scenario, not just recall it?",
                followUps: {
                    "1_2": "That‚Äôs honest‚Äîapplication requires intentional planning. To start small, think of the upcoming topic. What is **one simple real-world item or problem** you could bring into the classroom to let students immediately practice what they‚Äôve learned?",
                    "3": "Good! You sometimes include application. The next step is making it a habit. Could you identify one lesson next week where you will replace a **recall question with an application task**? For example, instead of ‚ÄòWhat is a square?‚Äô, ask ‚ÄòFind two square objects in this room.‚Äô",
                    "4_5": "Excellent! You focus on application, which builds real understanding. To push this further, think about **community connections**. What is one additional real-life or local connection you could use to make the concept relevant to their home life or neighborhood?",
                },
                task: "üå± **Design an application task:** Choose a concept for your next lesson and design one short activity where students apply it practically. Examples: measure a classroom object, sort local items based on properties, or use local language to describe a plant part.",
            },
            {
                id: 3,
                title: "Using Student Responses (Feedback Loop)",
                prompt: "After students complete an activity or share answers, how often do you use their responses to **adjust your next lesson‚Äôs content or pace**?",
                followUps: {
                    "1_2": "It's a great start just noticing patterns in responses. The goal is to make these patterns guide your instruction. For your next lesson, what could help you capture key insights efficiently, such as a **quick 3-question exit slip** or a small notebook to jot down common errors?",
                    "3": "Good! You sometimes use feedback. Try to formalize this process. Could you dedicate 5 minutes after each lesson to note **one key observation** (a common mistake or a success story) that will *directly* guide your planning for the following day?",
                    "4_5": "Fantastic! You are responsive to student learning. How could you take this further‚Äîperhaps by planning a **small follow-up activity** during the next class that explicitly targets the single, most common misconception you observed?",
                },
                task: "üå± **Actionable Insight:** After your next lesson, write one single sentence on what you will adjust based on student responses. Keep it short‚Äîjust one clear, instructional insight (e.g., 'Need to re-teach subtraction with borrowing').",
            },
            {
                id: 4,
                title: "Connecting to Learning Outcomes",
                prompt: "How often do you clearly define what **success looks like** for your students (the specific learning outcome) *before* planning any activity or lesson?",
                followUps: {
                    "1_2": "Many teachers start with content. Try shifting your focus to the outcome first. Pick one clear, measurable outcome for your next lesson (e.g., 'Students can identify three types of leaves')‚Äîit helps focus planning and assessment.",
                    "3": "Good! You sometimes define outcomes. To ensure alignment with CBE, could you break that outcome down into **1‚Äì2 small, observable skills or knowledge points**? (e.g., 'Skill 1: Match leaf to tree. Skill 2: Describe leaf shape.')",
                    "4_5": "Great! Clear learning outcomes guide every activity. How could you link an activity *directly* to the outcome next time‚Äîperhaps by **sharing the success criteria with students** at the beginning of the lesson so they know exactly what they need to achieve?",
                },
                task: "üå± **Deconstruct the Outcome:** Take the learning outcome for your next lesson and break it into 1‚Äì2 small, measurable skills or knowledge points. Plan one targeted activity for each point.",
            },
            {
                id: 5,
                title: "Thematic Planning (Relatability)",
                prompt: "If you were teaching a topic like ‚ÄúWater‚Äù or ‚ÄúSeasons,‚Äù how often do you select a theme that makes lessons **meaningful and highly relatable** to the students' local context?",
                followUps: {
                    "1_2": "No worries! Themes can dramatically increase engagement. Think of one simple, accessible theme from students‚Äô daily life (e.g., 'Our Local Market' or 'My Family Garden') for the next topic and see how you can connect your concepts to it.",
                    "3": "Good start. You understand the value of connection. Could you list 2-3 specific ways you will connect lessons or activities to the chosen theme next week? For instance, 'Use market price examples for math problems' and 'Draw locally grown vegetables for art.'",
                    "4_5": "Excellent! You focus on making learning relevant. To deepen this, how could you make the theme even more relevant by **inviting a community member** (like a local farmer or artisan) to briefly share their knowledge, linking the curriculum directly to local wisdom?",
                },
                task: "üå± **Local Connection:** Choose a theme for your next topic and list two simple ways to connect lessons or activities to it. Use local examples or resource people if possible.",
            },
            {
                id: 6,
                title: "Assessment for Learning (AFL)",
                prompt: "How often do you use quick, informal checks (like **thumbs up/down**, mini whiteboards, or simple **exit tickets**) *during* the lesson to gauge student understanding and instantly adjust?",
                followUps: {
                    "1_2": "It's natural to rely on formal tests, but quick checks are critical in CBE. What is one **zero-prep, non-writing strategy** (like a 'traffic light' system: Red=Confused, Green=Ready) you can commit to using at least twice in your next 40-minute lesson?",
                    "3": "You're already incorporating quick checks‚Äîthat's great. How often do you use the information to genuinely **change the next 5 minutes of instruction**? For example, seeing mostly 'yellow' responses and immediately deciding to run one more example on the board.",
                    "4_5": "Fantastic! Using AFL for instant adjustment is a strong practice. To make it systematic, how could you **record the results** of one specific check (e.g., which students struggled with the 'thumbs down') and use it to group students for a targeted mini-revision at the start of the next day?",
                },
                task: "üå± **Implement one AFL tool:** Prepare a set of three simple True/False questions related to your next lesson's core concept. Use a 'thumbs up' for true and 'thumbs down' for false halfway through the lesson, and adjust your teaching immediately based on the majority response.",
            },
            {
                id: 7,
                title: "Differentiated Instruction",
                prompt: "When planning an activity, how often do you prepare different options or levels of challenge (**e.g., giving advanced students a challenge or providing scaffolding for struggling students**)?",
                followUps: {
                    "1_2": "Differentiation takes time, but it ensures no student is left behind or bored. To start small, pick one activity next week. Can you prepare one **‚Äòfast finisher‚Äô extension task** for your most advanced students?",
                    "3": "You sometimes differentiate, which shows commitment to student needs. For the next unit, can you identify two specific students‚Äîone who needs **extra support** and one who needs **more challenge**‚Äîand plan a *single* modified question or resource for each of them?",
                    "4_5": "Excellent! You are meeting students where they are. To make differentiation routine, how could you set up a **‚Äòchoice board‚Äô** (3‚Äì4 activities, all leading to the same outcome) where students can select the activity that best suits their learning style or pace?",
                },
                task: "üå± **Create a tiered challenge:** For your next practice session, design three versions of the same task: **Level 1 (Simplified)**, **Level 2 (Standard)**, and **Level 3 (Challenge)**. Allow students to pick their starting point.",
            },
        ];

        const results = {};
        const reflectionsList = document.getElementById('reflections-list');
        const summaryDiv = document.getElementById('wrap-up-summary');
        const summaryText = document.getElementById('summary-text');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');

        // Function to render the reflection items
        function renderReflections() {
            reflectionsList.innerHTML = REFLECTIONS.map(r => {
                // FIX: Apply markdown conversion to the prompt text here
                const formattedPrompt = r.prompt.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');

                return `
                <div id="reflection-${r.id}" class="reflection-card bg-white p-6 rounded-xl">
                    <h3 class="text-xl font-semibold text-gray-800 mb-2">Reflection ${r.id}: ${r.title}</h3>
                    <p class="text-gray-600 mb-4">${formattedPrompt} <span class="font-bold">(1 = Never, 5 = Always)</span></p>

                    <div class="flex space-x-2 mb-4 justify-center sm:justify-start">
                        ${[1, 2, 3, 4, 5].map(rating => `
                            <button
                                data-id="${r.id}"
                                data-rating="${rating}"
                                onclick="handleRatingClick(this)"
                                class="rating-button w-10 h-10 rounded-full border-2 border-teal-400 text-teal-600 font-bold bg-teal-50 hover:bg-teal-100 focus:outline-none focus:ring-4 focus:ring-teal-300"
                            >
                                ${rating}
                            </button>
                        `).join('')}
                    </div>

                    <!-- Adaptive Feedback Area (Uses 'feedback-area' class for animation) -->
                    <div id="feedback-${r.id}" class="feedback-area">
                        <p class="text-violet-700 italic mb-3" id="follow-up-${r.id}"></p>
                        <div class="task-box p-3 rounded-lg text-sm text-green-800 font-medium" id="task-${r.id}"></div>
                    </div>
                </div>
            `;
            }).join('');
            
            // Update initial progress text for 7 reflections
            progressText.textContent = `0 of ${REFLECTIONS.length} reflections complete`;
        }
        
        // Function to update the progress bar
        function updateProgress() {
            const completedCount = Object.keys(results).length;
            const totalCount = REFLECTIONS.length;
            const percentage = (completedCount / totalCount) * 100;

            progressBar.style.width = `${percentage}%`;
            progressText.textContent = `${completedCount} of ${totalCount} reflections complete`;
        }


        // Function to handle rating click
        function handleRatingClick(button) {
            const id = parseInt(button.getAttribute('data-id'));
            const rating = parseInt(button.getAttribute('data-rating'));
            const reflection = REFLECTIONS.find(r => r.id === id);

            if (!reflection) return;

            // 1. Update the results store and progress
            const isNewOrChangedRating = results[id] !== rating;
            results[id] = rating;
            
            if (isNewOrChangedRating) {
                updateProgress(); // Update progress only on a new or changed rating
            }

            // 2. Clear previous selections and highlight the current button
            const container = button.closest('.reflection-card');
            container.querySelectorAll('.rating-button').forEach(btn => {
                // Remove selected classes
                btn.classList.remove('selected', 'bg-emerald-500', 'text-white');
                // Add unselected Teal classes
                btn.classList.add('bg-teal-50', 'text-teal-600');
            });
            // Add selected Green classes
            button.classList.add('selected', 'bg-emerald-500', 'text-white');
            // Remove unselected classes
            button.classList.remove('bg-teal-50', 'text-teal-600');
            
            // Mark card as completed and update its border color (handled by CSS .completed class)
            container.classList.add('completed');


            // 3. Determine the correct follow-up key
            let followUpKey;
            if (rating === 1 || rating === 2) {
                followUpKey = "1_2";
            } else if (rating === 3) {
                followUpKey = "3";
            } else { // 4 or 5
                followUpKey = "4_5";
            }

            // 4. Inject feedback and task
            const followUpElement = document.getElementById(`follow-up-${id}`);
            const taskElement = document.getElementById(`task-${id}`);
            const feedbackDiv = document.getElementById(`feedback-${id}`);

            // Apply markdown conversion for follow-up text and task
            followUpElement.innerHTML = reflection.followUps[followUpKey].replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>'); 
            taskElement.innerHTML = reflection.task.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');

            // 5. Show the feedback area with animation
            feedbackDiv.classList.add('visible');
            
            // 6. Check if all reflections are complete, otherwise scroll to next
            const completedCount = Object.keys(results).length;
            if (completedCount === REFLECTIONS.length) {
                showWrapUpSummary();
            } else {
                // Scroll to the next uncompleted reflection
                const nextId = id + 1;
                const nextReflection = document.getElementById(`reflection-${nextId}`);
                if (nextReflection) {
                    // Slight delay to allow feedback animation to start before scrolling
                    setTimeout(() => {
                        nextReflection.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }, 500);
                }
            }
        }

        // Function to show the final summary with animation
        function showWrapUpSummary() {
            // Calculate average rating
            const totalScore = Object.values(results).reduce((sum, score) => sum + score, 0);
            const averageScore = totalScore / REFLECTIONS.length;
            let personalizedComment = "";

            if (averageScore <= 2.5) {
                personalizedComment = "You've identified several areas for growth, which is a fantastic first step! Focusing on one small action from your tasks, like the 'Think-Pair-Share' technique or defining one clear learning outcome, will lead to meaningful change.";
            } else if (averageScore < 4) {
                personalizedComment = "Your reflection shows a solid foundation! You've already incorporated several effective practices. Keep building on this by consistently using Assessment for Learning (AFL) and looking for more opportunities to differentiate instruction.";
            } else {
                personalizedComment = "Excellent work! Your responses highlight a strong alignment with core competency-based habits‚Äîengaging learners, checking understanding, and connecting lessons to clear outcomes. Focus on those 'one more small way' extension ideas to elevate your planning.";
            }

            // Define the core summary message with markdown
            const coreSummary = `Overall, you‚Äôve already shown several great competency-based habits related to **student agency**, checking **application**, adjusting based on **feedback**, connecting lessons to clear **outcomes** and **themes**, and practicing **AFL** and **differentiation**. Small actions from your tasks will make your planning even stronger.`;

            // Combine personalized comment and core summary, applying markdown conversion to the core summary
            const fullSummaryHTML = `
                ${personalizedComment}<br><br>
                ${coreSummary.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')}
            `;

            summaryText.innerHTML = fullSummaryHTML;
            
            // Animate the summary box reveal
            summaryDiv.style.opacity = '0';
            summaryDiv.classList.remove('hidden');
            setTimeout(() => {
                summaryDiv.style.transition = 'opacity 1s ease-in';
                summaryDiv.style.opacity = '1';
                // Scroll to the summary
                summaryDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);
        }

        // Initialize the flow on load
        window.onload = renderReflections;
    </script>
</body>
</html>
